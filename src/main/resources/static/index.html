<!DOCTYPE html>
<html>
<head>
    <title>Transaction Count Chart</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin-bottom: 20px; /* Добавляем отступ между графиками */
        }

        .status-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        #status {
            text-align: center;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="status-container">
    <h1 id="status"></h1>
</div>
<div class="chart-container">
    <canvas id="todayChart"></canvas>
</div>
<div class="chart-container">
    <canvas id="averageChart"></canvas>
</div>
<div class="chart-container">
    <canvas id="standardDeviationChart"></canvas>
</div>

</body>
</html>

<script>
    async function drawChart() {
        const transaction = await fetchData();

        const todayPeriods = transaction.todayPeriods;
        const todayTransactionsSize = transaction.todayTransactionsSize;
        const averagePeriods = transaction.averagePeriods;
        const averageTransactionsSize = transaction.averageTransactionsSize;
        const standardDeviationsPeriods = transaction.standardDeviationsPeriods;
        const standardDeviations = transaction.standardDeviations;

        var blockChainStatus = document.getElementById("status");

        if (transaction.blockChainStatus) {
            blockChainStatus.style.color = "green";
            blockChainStatus.innerText = "Activity in the blockchain is normal";
        } else {
            blockChainStatus.style.color = "red";
            blockChainStatus.innerText = "Abnormal activity detected!";
        }

        new Chart(document.getElementById('todayChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: todayPeriods,
                datasets: [{
                    label: 'Ethereum Daily Transactions Chart',
                    data: todayTransactionsSize,
                    backgroundColor: 'rgba(0, 123, 255, 0.5)',
                    borderColor: 'rgba(0, 123, 255, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Transactions size'
                        }
                    },
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Time (Hours)'
                        }
                    }
                },
                maintainAspectRatio: false
            }
        });

        new Chart(document.getElementById('averageChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: averagePeriods,
                datasets: [{
                    label: 'Ethereum Average Transactions Chart',
                    data: averageTransactionsSize,
                    backgroundColor: 'green',
                    borderColor: 'green',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Transactions size'
                        }
                    },
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Time (Hours)'
                        }
                    }
                },
                maintainAspectRatio: false
            }
        });

        new Chart(document.getElementById('standardDeviationChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: standardDeviationsPeriods, // Здесь можно указать метки оси X
                datasets: [{
                    label: 'Standard Deviations Chart',
                    data: standardDeviations,
                    backgroundColor: 'purple',
                    borderColor: 'purple',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Deviation'
                        }
                    },
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Time (Hours)'
                        }
                    }
                },
                maintainAspectRatio: false
            }
        });
    }

    async function fetchData() {
        try {
            const response = await fetch("/chart");
            return await response.json();
        } catch (error) {
            console.log(error);
            throw error;
        }
    }

    drawChart();
    setTimeout(function () {
        location.reload();
    }, 20000);
</script>
